name: Deploy - Demos
run-name: ${{ github.ref_name == 'main' && 'ğŸš€' || 'ğŸ§ª' }} Deploy - Demos
env:
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

on:
  workflow_dispatch:

jobs:
  deployment:
    runs-on: ubuntu-latest
    steps:
      - name: âš™ï¸ Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: â¬‡ï¸ Checkout current repo
        uses: actions/checkout@v4
        with:
          path: shadcn-studio/internal

      - name: â¬‡ï¸ Checkout automation-scripts repo
        uses: actions/checkout@v4
        with:
          repository: themeselection/automation-scripts
          token: ${{ secrets.GH_PAT }}
          path: automation-scripts

      - name: â¬‡ï¸ Install packages in automation-scripts dir
        working-directory: automation-scripts/nextjs
        run: pnpm i

      - name: â¬‡ï¸ Install packages in current repo
        working-directory: shadcn-studio/internal
        run: pnpm i

      - name: ğŸ“¦ Build
        working-directory: automation-scripts/nextjs
        run: pnpm install vercel && pnpm tsx ./src/shadcn-studio/template/generateBuild.ts $([[ "${{ github.ref_name == 'main' }}" == "true" ]] && echo --prod) --vercel-token ${{ secrets.VERCEL_TOKEN }}

      - name: ğŸš€ Deploy to Vercel
        working-directory: shadcn-studio/internal
        run: pnpm install -w vercel && pnpm exec vercel $([[ "${{ github.ref_name == 'main' }}" == "true" ]] && echo --prod) --prebuilt --token ${{ secrets.VERCEL_TOKEN }}
